pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
ents = {}
events = {}
game_over = false

function _init()

 ents = {}
 events = {}
 game_over = false

 add(ents, create_player())
 add(ents, create_enemy(115, 115))
 add(ents, create_spawner())
 
end

function _update()

 if (game_over == true) then
 	if (btnp(5)) then
 		_init()
 	end
  return
 end

 for ent in all(ents) do
  ent.update()
 end
 
 events = {}
 
end

function _draw()

 rectfill(0, 0, 127, 127, 0)
 rect(0, 0, 125, 125, 5)
 
 for ent in all(ents) do
  ent.draw()
 end
 
 if (game_over == true) then
  print("game over!", 45, 60, 8)
  print("press ❎ when ready", 25, 70, 6)
 end
 
end

function get_player()
 for ent in all(ents) do
  if (ent.type == "player") then
   return ent
  end
 end
end

-->8

function create_player()

 local ent = {}
 ent.type = "player"
 ent.x = 60
 ent.y = 60
 
 ent.draw = function()
  print("x", ent.x, ent.y, 7)
 end

 ent.update = function()
  if (btnp(3) and ent.y<115) then
   ent.y += 5
   ent.add_moved_event()
  elseif (btnp(2) and ent.y>5) then
   ent.y -= 5
   ent.add_moved_event()
  elseif (btnp(0) and ent.x>5) then
   ent.x -= 5
   ent.add_moved_event()
  elseif (btnp(1) and ent.x<120) then
   ent.x += 5
   ent.add_moved_event()
  end
 end
 
 ent.add_moved_event = function()
  add(events, "moved")
  sfx(0)
 end 
 
 return ent

end


-->8

function create_enemy(x, y)

 local ent = {}
 ent.type = "enemy"
 ent.x = x
 ent.y = y
 
 ent.draw = function()
  print("y", ent.x, ent.y, 7)
 end

 ent.update = function()
  for event in all(events) do
   if (event == "moved") then
    
    local player = get_player()
   
    if (rnd(100)<50) then
     rand_move = 5
    else
     rand_move = -5
    end
   
    if (rnd(100)<50) then
     if (player.x < ent.x) then 
     	ent.x -= 5
     elseif (player.x > ent.x) then
      ent.x += 5
     else
      ent.x += rand_move
     end
				else
     if (player.y < ent.y) then 
     	ent.y -= 5
     elseif (player.y > ent.y) then
      ent.y += 5
     else
      ent.y += rand_move
     end
    end
    
    if (player.x == ent.x and
        player.y == ent.y) then
       
					sfx(1)
				 game_over = true
        
    end
    
   end
  end
 end
 
 return ent

end

-->8

function create_spawner()

 local ent = {}
 ent.type = "spawner"
 ent.spawn_counter = 0
 ent.spawn_counter_limit = 15
 
 ent.draw = function()
  
 end

 ent.update = function()
 
  for event in all(events) do
   if (event == "moved") then
    ent.spawn_counter += 1
   end
  end
  
  if (ent.spawn_counter >= 
      ent.spawn_counter_limit) then
      
   ent.spawn_counter = 0
   
   local player = get_player()
   
   local enemy_x = player.x
   local enemy_y = player.y
   
   if (rnd(100)<50) then
    enemy_x -= 120
   else
    enemy_x += 120
   end
   
   if (rnd(100)<50) then
    enemy_y -= 120
   else
    enemy_y += 120
   end
   
   add(ents, create_enemy(enemy_x, enemy_y))
    
  end
  
 end 
 
 return ent

end


__label__
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070700000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070700000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070700000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070700000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000070700000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000070700000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000077700000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000077700000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000007070000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000007070000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000007770000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000070000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000007770000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070700000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070700000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077700000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000700000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077700000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070700000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070700000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077700000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077700000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000707000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000707000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000777000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000777000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555500
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

__sfx__
0104000016050140500c0501505000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011000001705017050130501305010050100500c05000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
